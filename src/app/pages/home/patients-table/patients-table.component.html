<p-card header="Pacientes">
  <div class="flex justify-content-between mb-2">
    <span class="p-input-icon-left">
      <i class="pi pi-search"></i>
      <input
        pInputText
        type="text"
        placeholder="Buscar..."
        (input)="dt.filterGlobal($any($event.target).value, 'contains')"
      />
    </span>
    <div class="flex gap-2">
      <button
        pButton
        label="Nuevo +"
        icon="pi pi-plus"
        class="p-button-success"
        (click)="newPatient()"
      ></button>
      <button
        pButton
        label="Exportar CSV"
        icon="pi pi-download"
        class="p-button-info"
        (click)="exportCSV()"
      ></button>
    </div>
  </div>

  <p-table
    #dt
    [value]="(patients$ | async) || []"
    [paginator]="true"
    [rows]="10"
    [rowsPerPageOptions]="[5,10,25]"
    sortMode="multiple"
    [globalFilterFields]="[
      'documentType.name',
      'document',
      'firstName',
      'lastName',
      'email'
    ]"
    responsiveLayout="scroll"
    [showCurrentPageReport]="true"
    currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords}"
  >
    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="documentType.name">
          Tipo <p-sortIcon field="documentType.name"></p-sortIcon>
        </th>
        <th pSortableColumn="document">
          Documento <p-sortIcon field="document"></p-sortIcon>
        </th>
        <th pSortableColumn="firstName">
          Nombres <p-sortIcon field="firstName"></p-sortIcon>
        </th>
        <th pSortableColumn="lastName">
          Apellidos <p-sortIcon field="lastName"></p-sortIcon>
        </th>
        <th pSortableColumn="phoneNumber">
          Tel√©fono <p-sortIcon field="phoneNumber"></p-sortIcon>
        </th>
        <th pSortableColumn="email">
          Email <p-sortIcon field="email"></p-sortIcon>
        </th>
        <th>Acciones</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-patient>
      <tr>
        <td>{{ patient.documentType.name }}</td>
        <td>{{ patient.document }}</td>
        <td>{{ patient.firstName }}</td>
        <td>{{ patient.lastName }}</td>
        <td>{{ patient.phoneNumber || '-' }}</td>
        <td>{{ patient.email || '-' }}</td>
        <td class="flex gap-2">
          <button
            pButton
            icon="pi pi-pencil"
            class="p-button-warning p-button-sm"
            (click)="editPatient(patient)"
          ></button>
          <button
            pButton
            icon="pi pi-trash"
            class="p-button-danger p-button-sm"
            (click)="deletePatient(patient)"
          ></button>
          <button
            pButton
            icon="pi pi-eye"
            class="p-button-primary p-button-sm"
            (click)="goToHistory(patient)"
          ></button>
        </td>
      </tr>
    </ng-template>
  </p-table>

  <app-create-update-patient></app-create-update-patient>
</p-card>
